<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>植物の分類わけクイズゲーム</title>
  <style>
    body {
      touch-action: manipulation;
      background-color: black;
      color: white;
      font-family: 'Press Start 2P', monospace;
      margin: 0;
      padding: 0;
      text-align: center;
    }
    #gameContainer {
      width: 90vw;
      max-width: 100vw;
      background-color: black;
      color: white;
      text-align: center;
      margin: auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }
    .dq-frame {
      border: 3px double white;
      background-color: black;
      color: white;
      padding: 8px;
      margin: 10px auto;
      box-sizing: border-box;
    }
    .button {
      background-color: black;
      border: 2px solid white;
      color: white;
      padding: 8px 12px;
      margin: 5px;
      cursor: pointer;
      font-family: 'Press Start 2P', monospace;
      font-size: 14px;
    }
    .button:hover {
      background-color: white;
      color: black;
    }
  </style>
</head>
<body>
  <div id="gameContainer">
    <div id="startScreen" class="dq-frame">
      <button id="startButton" class="button">スタート</button>
    </div>
    
    <div id="gameScreen" style="display: none;">
      <div id="messageBox" class="dq-frame"></div>
      <div>
        <span>BGMの有無: </span>
        <button id="muteButton" class="button">音 ON</button>
      </div>
      <div id="endScreen" class="dq-frame" style="display: none;">
        <button id="mouthButton" class="button">▶くちぶえ</button>
      </div>
    </div>
  </div>
  
  <audio id="bgm" src="https://kogkoba.github.io/bunrui/sciencebgm.mp3" loop></audio>
  <audio id="dqWinSound" src="https://kogkoba.github.io/bunruiq4i/DQwin.mp3"></audio>
  <audio id="dqDownSound" src="https://kogkoba.github.io/bunruiq4i/DQdown.mp3"></audio>

  <script>
    const startScreen = document.getElementById("startScreen");
    const startButton = document.getElementById("startButton");
    const gameScreen = document.getElementById("gameScreen");
    const messageBox = document.getElementById("messageBox");
    const mouthButton = document.getElementById("mouthButton");
    const endScreen = document.getElementById("endScreen");
    const bgm = document.getElementById("bgm");
    const dqWinSound = document.getElementById("dqWinSound");
    const dqDownSound = document.getElementById("dqDownSound");
    const muteButton = document.getElementById("muteButton");

    let isMuted = localStorage.getItem("bgmMuted") === "true";
    bgm.muted = isMuted;
    muteButton.textContent = isMuted ? "音 ON" : "音 OFF";

    // ✅ BGMのミュートトグル
    muteButton.addEventListener("click", () => {
      bgm.muted = !bgm.muted;
      localStorage.setItem("bgmMuted", bgm.muted);
      muteButton.textContent = bgm.muted ? "音 ON" : "音 OFF";
      if (!bgm.muted) {
        bgm.play().catch(error => console.error("BGM再生エラー:", error));
      }
    });

    // ✅ スタートボタン（ゲーム開始）
    startButton.addEventListener("click", startGame);

    // ✅ くちぶえボタン（ゲームリセット）
    mouthButton.addEventListener("click", () => {
      dqWinSound.pause();
      dqWinSound.currentTime = 0;
      dqDownSound.pause();
      dqDownSound.currentTime = 0;
      location.reload();
    });

    function startGame() {
      startScreen.style.display = "none";
      gameScreen.style.display = "block";
      if (!bgm.muted) {
        bgm.play().catch(error => console.error("BGM再生エラー:", error));
      }
      nextQuestion();
    }

    function nextQuestion() {
      messageBox.innerText = "新しい問題が出題されました！";
    }

    function checkGameOver(playerLost) {
      bgm.pause();
      bgm.currentTime = 0;

      if (playerLost) {
        messageBox.innerText = "プレイヤーは　たおれた。";
        dqDownSound.play().catch(error => console.error("音の再生エラー:", error));
      } else {
        messageBox.innerText = "植物は　たおれた。";
        dqWinSound.play().catch(error => console.error("音の再生エラー:", error));
      }

      endScreen.style.display = "block";
    }
  </script>
</body>
</html>
